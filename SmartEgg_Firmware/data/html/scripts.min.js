function startRecord(){$("#record").hide(),$("#starting-btn").show(),ajaxStartRecord()}function ajaxStartRecord(){var t=m_DropDataList[m_activeDropIndex].name,a=urlEndPoint+"/recordStart/"+t;return $.ajax({dataType:"text",url:a}).done(function(t){console.log(t),$("#starting-btn").hide(),0!=t?(alert("Error with egg record, forcing stop. Try starting the drop again."),$("#record").show(),$("#stop").hide(),-2==t&&HTTPRequest(urlEndPoint+"/recordStop",function(t){console.log("recordStop Status: "+t)})):$("#stop").show()}).fail(function(t,a,e){console.log(a+": "+e)})}function stopRecord(){$("#stop").hide(),$("#loading").show(),ajaxStopRecord().then(ajaxGetDropData)}function ajaxStopRecord(){return $.ajax({dataType:"text",url:urlEndPoint+"/recordStop"}).done(function(t){console.log("stopping status: "+t)}).fail(function(t,a,e){console.log(a+": "+e)})}function ajaxGetDropData(){var t=m_DropDataList[m_activeDropIndex],a=urlEndPoint+"/recordGetMagnitudes/"+t.name;return $.ajax({dataType:"text",url:a}).done(function(a){console.log("data retrieved: "+a);var e=parseDataMagnitude(a);t.chartData=e,buildChart(t.chartData),sessionStorage.setItem(t.name,JSON.stringify(t.chartData)),$("#loading").hide(),$("#download-btn").show()}).fail(function(t,a,e){console.log(a+": "+e)})}function downloadCsv(){var t=m_DropDataList[m_activeDropIndex].chartData,a="data:text/csv;charset=utf-8,";a+="t, g\r\n";for(var e=0;e<t.length;e++)a+=t[e]+"\r\n";var o=encodeURI(a),n=document.createElement("a");n.setAttribute("href",o),n.setAttribute("download","my_data.csv"),document.body.appendChild(n),n.click()}function deleteDrop(){var t=m_DropDataList[m_activeDropIndex].name;$("#Drop-"+t).remove(),$("#drop-details-container").hide(),$("#confirm-delete").prop("disabled",!0).addClass("is-loading"),ajaxDeleteDrop()}function ajaxDeleteDrop(){var t=m_DropDataList[m_activeDropIndex].name,a=urlEndPoint+"/recordDelete/"+t;return $.ajax({dataType:"text",url:a}).done(function(a){sessionStorage.removeItem(t),m_activeDropIndex>-1&&m_DropDataList.splice(m_activeDropIndex,1),m_activeDropIndex=null,$("#confirm-delete").prop("disabled",!1).removeClass("is-loading"),closeModal(),console.log("Delete Status: "+a)}).fail(function(t,a,e){console.log(a+": "+e)})}function openConfirmDeleteDialog(){buildModal(),$(".modal").addClass("is-active")}function closeModal(){$(".modal").removeClass("is-active"),$("#modal-area").val("")}function createDrop(t,a){return{name:t,chartData:a}}function updateDropList(){ajaxUpdateDropList().then(LoadAllDropData)}function LoadAllDropData(){for(var t=0;t<m_DropDataList.length;t++){var a=m_DropDataList[t],e=JSON.parse(sessionStorage.getItem(a.name));null!=e?a.chartData=e:ajaxLoadAllDropData(a,t)}}function ajaxLoadAllDropData(t,a){var e=urlEndPoint+"/recordGetMagnitudes/"+t.name;return $.ajax({dataType:"text",url:e}).done(function(e){console.log("data retrieved: "+e);var o=parseDataMagnitude(e);t.chartData=o,sessionStorage.setItem(t.name,JSON.stringify(t.chartData)),a==m_DropDataList.length-1?($("#loading").hide(),$("#main-content").show()):ajaxLoadAllDropData(m_DropDataList[a+1],a+1)}).fail(function(t,a,e){console.log(a+": "+e)})}function ajaxUpdateDropList(){var t=urlEndPoint+"/recordList";return $.ajax({dataType:"text",url:t}).done(function(t){if(t=t.substring(0,t.length-1),console.log("recordList:\n"+t),""!=t)for(var a=t.split("\n"),e=0;e<a.length;e++)addDrop(a[e],[])}).fail(function(t,a,e){console.log(a+": "+e)})}function addDrop(t,a){var e={id:m_DropDataList.length,name:t,chartData:a};m_DropDataList.push(e),this.addTab(e.id,t)}function nameIsUnique(t){for(var a=0;a<m_DropDataList.length;a++)if(m_DropDataList[a].name==t)return!1;return!0}function nameIsValid(t){var a=!0;return(t.indexOf(" ")>=0||/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g.test(t)||0==t.length)&&(a=!1),a}function addTab(t,a){$("#drop-history").append("<li id=Drop-"+a+'> <a onClick="newDataSelected('+t+')">'+a+"</a></li>")}function addNewDrop(){var t=$("#drop-name").val(),a=this.nameIsUnique(t);if(this.nameIsValid(t))if(a){$("#drop-name").val("");m_DropDataList.length;curDataList=[],this.addDrop(t,curDataList)}else alert("The name "+t+" is already used. Please use a unique name.");else alert("The name "+t+" is invalid. Please remove all spaces and special characters from the name.")}function buildModal(){var t=m_DropDataList[m_activeDropIndex].name;$("#modal-area").append('<div id="my-modal" class="modal">\t\t<div class="modal-background"></div>\t\t\t<div class="modal-card">\t\t\t\t<header class="modal-card-head">\t\t\t\t\t<p class="modal-card-title">Confirm Delete</p>\t\t\t\t\t<button class="delete" aria-label="close" onClick="closeModal()"></button>\t\t\t\t</header>\t\t\t\t<section class="modal-card-body">\t\t\t\t\t\x3c!-- Content ... --\x3e\t\t\t\t\tAre you sure you\'d like to delete the drop "'+t+'"? There is no undoing this operation. \t\t\t\t</section>\t\t\t\t<footer class="modal-card-foot">\t\t\t\t\t<button id="confirm-delete" class="button is-danger" onClick="deleteDrop()">Delete Drop</button>\t\t\t\t\t<button id="close-modal" class="button" onClick="closeModal()">Cancel</button>\t\t\t\t</footer>\t\t\t</div>\t\t</div>')}function newDataSelected(t){null!=m_activeDropIndex&&$("#Drop-"+m_DropDataList[m_activeDropIndex].name).removeClass("is-active"),$("#Drop-"+m_DropDataList[t].name).addClass("is-active"),m_activeDropIndex=t,$("#drop-details-container").show(),console.log("Selected Tab: "+m_DropDataList[t].name),selectedData=m_DropDataList[t].chartData,0==selectedData.length?($("#record").show(),$("#download-btn").hide()):($("#record").hide(),$("#download-btn").show());buildChart(selectedData)}function parseDataMagnitude(t){var a=[];resultList=t.split("\n");for(var e=1;e<resultList.length;e++){var o=resultList[e].split(","),n=(parseFloat(o[0]),parseFloat(o[1]));a.push(n)}return a}function buildChart(t){return Highcharts.chart("charting-container",{chart:{type:"line",zoomType:"x"},title:{text:"Smart Egg Force Graph"},subtitle:{},scrollbar:{enabled:!0},xAxis:{title:{text:"Time(s)"}},yAxis:{title:{text:"Force(g)"}},legend:{layout:"vertical",align:"right",verticalAlign:"middle"},plotOptions:{},series:[{name:"Force (g)",data:t}],responsive:{rules:[{condition:{},chartOptions:{legend:{layout:"horizontal",align:"center",verticalAlign:"bottom"}}}]}})}function makeHTTPObject(){try{return new XMLHttpRequest}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}throw new Error("Could not create HTTP request object.")}function HTTPRequest(t,a){var e=makeHTTPObject();e.onreadystatechange=function(){if(4==e.readyState){if(200!=e.status)throw new Error("Empty Data in HTTP Request");a(e.responseText)}},e.open("GET",t,!0),e.send(null)}var m_DropDataList=[],m_activeDropIndex,urlEndPoint="/functions";$(document).ready(function(){$("#stop").hide(),$("#loading-btn").hide(),$("#download-btn").hide(),$("#loading").hide(),$("#starting-btn").hide(),updateDropList()});